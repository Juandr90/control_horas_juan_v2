
window.XLSX = {
  utils: {
    book_new: function(){ return {SheetNames:[], Sheets:{}}; },
    aoa_to_sheet: function(data){ return {__data: data}; },
    book_append_sheet: function(wb, ws, name){ wb.SheetNames.push(name); wb.Sheets[name]=ws; }
  },
  write: function(wb, opts){
    var ws = wb.Sheets[wb.SheetNames[0]];
    var rows = ws.__data.map(r=>r.map(c=>('"' + String(c).replace(/"/g,'""') + '"')).join(',')).join('\n');
    var encoder = new TextEncoder();
    return encoder.encode(rows);
  }
};
